---
title: "Growth-Promoting Fungi Evaluation"
author: "Carolina Juncá, Riyad Hilal and Ignacio Romero"

date: "18/01/2021"
output:
  html_document:
    code_folding: hide

---

```{r setup, include=FALSE}
knitr::opts_chunk$set
```

## Introduction

In typically intensive crops like bean, maize or soybean are able to reach high yields thanks to the abusive use of pesticides and fertilizers. In an attempt to manage agriculture in a more sustainable way, Noemi Carla Baron<sup>1</sup> , Andressa de Souza Pollo<sup>2</sup> and  Everlon Cid Rigobelo<sup>1</sup> in their article [" Purpureocillium lilacinum and Metarhizium marquandii as plant growth-promoting fungi."](https://peerj.com/articles/9005/) test the performance of *Purpureocillium lilacinum, Purpureocillium lavendulum* and *Metarhizium marquandii* as potential bioinoculants that might replace the current products. 

In order to do so, Baron et al. isolated the strains used from soil samples. All the different strains where screend for their ability to solubilize phosphorus (P) and produce indolacetic acid (IAA). Those who were more promising were tested in greenhouse inoculation experiments, where Growth promotion parameters including plant height, dry mass and contents of P and nitrogen (N) in the plants and in the rhizospheric soil were assessed. As statistical analysis software AGROESTAT was used. 

In this project, the results obtained by the authors is reanalyzed and reformulated using RStudio and  different packages that allow to carry out any analysis and display the output in a more convenient way. 

The packages used are the next: 

```{r Packages used, message = FALSE, warning = FALSE, results="hide", class.source = 'fold-show' }
#install.packages("agricolae")
library(agricolae)
#install.packages("lmtest")
library(lmtest)
#install.packages("ggplot2")
library(ggplot2)
#install.packages("rstatix")
library (rstatix)
#install.packages("nortest")
library (nortest)
#install.packages("BBmisc")
library(BBmisc)
# install.packages("dplyr")
library(dplyr)
# install.packages("readxl")
library(readxl)
# install.packages("tidyr")
library(tidyr)
#install.packages("kableExtra")
library(kableExtra)
#install.packages("tidyverse")
library(tidyverse)
#install.packages('factoextra')
library(factoextra)
```

## Objectives

1. Select which of the strains provided are the most promising to test in greenhouse experiment according to their P solubilization and IAA production.
  
2. Evaluate the performance of the strains selected by the authors by doing statistical analysis using the data provided. 

3. Carry out a Principal Components Analysis (PCA) and a Linear Discriminant Analisys (LDA) in order to adress ___________ AYUDA __________



## Data preparation

First of all, working in RStudio requires the importation of the data to the working environment and its shaping into a suitable data frame that allows its management and the utilization of the different tools that the software provides. 

The code for the importation creates a folder called "Data" where tables with raw data will be downloaded directly from the original article.
```{r Data importation}

#Creating the folder "Data" if it doesn't exist
D <- "Data"
if (!dir.exists(D)) dir.create(D)

#Bacteria IAA and P concentrations
xl_1 <- "https://dfzljdn9uc3pi.cloudfront.net/2020/9005/1/DatasetS1_Raw_Data__Screening__P_solubilization_and_IAA_production.xlsx"
download.file(xl_1, "Data/Data.xlsx", mode = "wb")

#Green House morphological trait measures
xl_2 <- "https://dfzljdn9uc3pi.cloudfront.net/2020/9005/1/Raw_Data_Greenhouse_tests.xlsx"
download.file(xl_2, "Data/Data_GH.xlsx", mode = "wb")
```

Different organized data frames where created from the raw data. This data frames contain the different strains tested , the repetitions and the biochemical or growth parameters. 

```{r Data organisation }

#Bacteria IAA and P concentrations

#readxl::excel_sheets("Data/Data.xlsx")  To check the sheet names
D_Phosphorus<- readxl::read_excel("Data/Data.xlsx", sheet = 1)
D_IndolA<- readxl::read_excel("Data/Data.xlsx", sheet = 2)

  #Filling in the LSM strain column
D_Phosphorus <- D_Phosphorus %>%
  fill(`LSM strain`)

D_IndolA <- D_IndolA %>%
  fill(`LSM strain`)

  #Merge the 2 dataframes
IAA_pg <- D_IndolA$`µg AIA/ g biomass`
D_Biochem <- cbind.data.frame(D_Phosphorus, IAA_pg)
names(D_Biochem)[names(D_Biochem) == "IAA_pg"] <- "µg IAA/ g biomass" #rename IAA column

#Green House morphological trait measures

#readxl::excel_sheets("Data/Data_GH.xlsx")
D_Bean <- readxl::read_excel("Data/Data_GH.xlsx", sheet = 1)
D_Maize <- readxl::read_excel("Data/Data_GH.xlsx", sheet = 2)
D_Soy <- readxl::read_excel("Data/Data_GH.xlsx", sheet = 3)

  #Filling in the treatments
D_Bean <- D_Bean %>%
  fill (`Treatments (strains)`)
D_Maize <- D_Maize %>%
  fill (`Treatments (strains)`)
D_Soy <- D_Soy %>%
  fill (`Treatments (strains)`)

  #Adding the crop name column
D_Bean$Cropname <- "Bean"
D_Maize$Cropname <- "Maize"
D_Soy$Cropname <- "Soybean"

  #Eliminate N Soil (%) column from D_Soy
D_Soy <- D_Soy[-which(names(D_Soy) == "N Soil (%)")] # - (eliminate) which column name in D_Soy is N Soil (%) (column 8)

  #Eliminate last two rows
D_Bean <- head(D_Bean, -2)
D_Maize <- head(D_Maize, -2)
D_Soy <- head(D_Soy, -2)

  #Merge the 3 dataframes
D_GH <- union(D_Bean, D_Maize) #check 2 lines between each merged dataframe, union_all for duplicates not to be removed
D_GH <- union(D_GH, D_Soy)
```

Once all the data is shaped and organized the analysis can begin. 

## Strain selection method

The Idol Acetic Acid (IAA) produced and the Phosphorous solubilized by each strain was tested in order to choose the ones with the highest amounts. In the original article, F and Tukey tests were done to figure this out. Nevertheless, although the IAA data was homeoscedastic, when the residuals of the IAA concentrations were tested for normality, it was found that their residues do not follow a normal distribution and thus the F and Tukey tests could not be conducted if a data transformation process wasn't made first.

### Idolacetic acid production:
Some tidying up of the data frame was done in order avoid errors when running the code.
````{r IAA tidy  }
D_IAA <- D_IndolA[-which(names(D_IndolA) == "Repetition")]
names(D_IAA)[names(D_IAA) == "µg AIA/ g biomass"] <- "IAA_pg" 
names(D_IAA)[names(D_IAA) == "LSM strain"] <- "LSM_strain" 

```

Normality was tested and as seen below, there are significant differences in the production of IAA among the strains:
````{r IAA ANOVA, message = FALSE, warning = FALSE, results= "show" }
D_IAA$LSM_strain <- as.factor(D_IAA$LSM_strain)
ANOVA_IAA<- aov (D_IAA$IAA_pg ~ D_IAA$LSM_strain, data= D_IAA)
print(summary(ANOVA_IAA))
```
 Lillie test Was chosen to do the in order to test the normality because...
```{r IAA Lillie test, message = FALSE, warning = FALSE, results= "show"}
nortest::lillie.test(ANOVA_IAA$residuals)
```
Afterwards, homoscedasticity was tested using the Breusch-Pagan test:
````{r Breusch-Pagan test , message = FALSE, warning = FALSE, results= "show" }
lmtest::bptest(ANOVA_IAA)
```

As they were not normal or homeoscedastic, Kruskal-Wallis and Holm analyses were carried out, obtaining the following groups:
````{r IAA K-W, out.width= "170%"}
kr <- agricolae::kruskal(D_IAA[2], D_IAA[1], alpha = 0.05, p.adj ="holm", group=TRUE)
kr$groups
plot (kr)

```

If the data were transformed with a logarithmic function normal residual and a homoscedastic data set  would be obtained:
```{r IAA transformation}
n_IAA <- log(D_IAA$IAA_pg)
n_D_IAA <- data.frame(n_IAA, D_IAA$LSM_strain)
ANOVA_n_IAA<- aov (n_D_IAA$n_IAA ~ n_D_IAA$D_IAA.LSM_strain, data= n_D_IAA)
print(summary(ANOVA_n_IAA))
nortest::lillie.test(ANOVA_n_IAA$residuals)

lmtest::bptest(ANOVA_n_IAA)
```

So ANOVA and Tukey test  could be done: 
````{r IAA Tukey, out.width= "170%"}
T_nIAA <- HSD.test(ANOVA_n_IAA,'n_D_IAA$D_IAA.LSM_strain', group = TRUE, alpha = 0.05)
T_nIAA$groups
plot(T_nIAA)

```
Also, Duncan test was done, in order to learn if there is some differences with Tukey's test:
```{r IAA Duncan, out.width= "170%"}
D_nIAA <- duncan.test(ANOVA_n_IAA,'n_D_IAA$D_IAA.LSM_strain')
plot(D_nIAA)
```
As expected, Duncan's test is more strict when grouping, meaning that considers that two values are not in the same group, when Tukey's tags them with the same letter. 

The analysis results in 5 strains being in the first and second groups, the LSM 65,62,68,179 and 183, being all of them present in the greenhouse experiments.



### Solubilized Phosphorous production:

As done previously some tidying up of the data frame was done in order to avoid errors when running the code.
````{r P tidy}
names(D_Phosphorus)[names(D_Phosphorus) == "µg P/ g biomass"] <- "P_pg" #rename µg P/ g biomass column
names(D_Phosphorus)[names(D_Phosphorus) == "LSM strain"] <- "LSM_strain" #rename LSM strain column

```

The data were tested for normality:
````{r P normality test}
ANOVA_P<- aov (D_Phosphorus$P_pg ~ D_Phosphorus$LSM_strain, data= D_Phosphorus)
print(summary(ANOVA_P))
nortest::lillie.test(ANOVA_P$residuals)

```

As the residuals were normal and the differences between strains were significant, a Duncan test was conducted:
````{r P Tukey, out.width= "170%"}

D_P <- duncan.test(ANOVA_P,'D_Phosphorus$LSM_strain')
D_P$groups
plot(D_P)

```
As seen in the Duncan's test, only the strain 24 highlights from the group. The rest of them slowly decrease in solubilized P production. This analysis does not provide enough resolution to choose those strains with a better potential performance. The autors of the article chose the first 3, belonging to the a, ab and abc groups: LSM 24, 65 and 14, in order. 

Additionally, the variance of strain 24 is very big, more repetitions would be needed in order to confidently deem it better than the others. If the upper extreme value is omitted, LSM 24 would belong to the same group as the other strains.

## Strain selection results

As seen above, due to the big amounts of strains that have to be analyzed and compare, is much more useful the Duncan's test than the Tukey's. However, the judgment of the authors remains unclear, since the choose 5 strains according to the IAA production and only 3 from solubilized P, despite the uncertainty of this last. 

In the end, the strains chosen to be analyzed are the following: **LSM 65, 62, 68, 179, 183, 24 and 14.**


## Strain evaluation method

A similar process has been followed to identify the most optimal strains in the greenhose experiments. First an ANOVA has been done, taking into account all the different requirements. Then, for those cases in which ANOVA is not possible, the Kruskal-Wallis' test has been done. For the rest of the cases, post hoc analisis was carried out to assess the different grouping options. 

### ANOVA 
The greenhouse results are tested in order to find out the effect of the selected strains. First of all, in order to address significant differences, an ANOVA test has been carried out. 

```{r ANOVA greenhouse, message = FALSE, warning = FALSE, results="hide"}
#Anovas for Bean 
anovabean3 <- aov(D_Bean[[3]]~D_Bean[[1]], data = D_Bean)
anovabean4 <- aov(D_Bean[[4]]~D_Bean[[1]], data = D_Bean)
anovabean5 <- aov(D_Bean[[5]]~D_Bean[[1]], data = D_Bean)
anovabean6 <- aov(D_Bean[[6]]~D_Bean[[1]], data = D_Bean)
anovabean7 <- aov(D_Bean[[7]]~D_Bean[[1]], data = D_Bean)
anovabean8 <- aov(D_Bean[[8]]~D_Bean[[1]], data = D_Bean)
anovabean9 <- aov(D_Bean[[9]]~D_Bean[[1]], data = D_Bean)
anovabean10 <- aov(D_Bean[[10]]~D_Bean[[1]], data = D_Bean)
anovabean11 <- aov(D_Bean[[11]]~D_Bean[[1]], data = D_Bean)

#Anova for Maize
anovamaize3 <- aov(D_Maize[[3]]~D_Maize[[1]], data = D_Maize)
anovamaize4 <- aov(D_Maize[[4]]~D_Maize[[1]], data = D_Maize)
anovamaize5 <- aov(D_Maize[[5]]~D_Maize[[1]], data = D_Maize)
anovamaize6 <- aov(D_Maize[[6]]~D_Maize[[1]], data = D_Maize)
anovamaize7 <- aov(D_Maize[[7]]~D_Maize[[1]], data = D_Maize)
anovamaize8 <- aov(D_Maize[[8]]~D_Maize[[1]], data = D_Maize)
anovamaize9 <- aov(D_Maize[[9]]~D_Maize[[1]], data = D_Maize)
anovamaize10 <- aov(D_Maize[[10]]~D_Maize[[1]], data = D_Maize)
anovamaize11 <- aov(D_Maize[[11]]~D_Maize[[1]], data = D_Maize)

#Anova for Soy
anovasoy3 <- aov(D_Soy[[3]]~D_Soy[[1]], data = D_Soy)
anovasoy4 <- aov(D_Soy[[4]]~D_Soy[[1]], data = D_Soy)
anovasoy5 <- aov(D_Soy[[5]]~D_Soy[[1]], data = D_Soy)
anovasoy6 <- aov(D_Soy[[6]]~D_Soy[[1]], data = D_Soy)
anovasoy7 <- aov(D_Soy[[7]]~D_Soy[[1]], data = D_Soy)
anovasoy8 <- aov(D_Soy[[8]]~D_Soy[[1]], data = D_Soy)
anovasoy9 <- aov(D_Soy[[9]]~D_Soy[[1]], data = D_Soy)
anovasoy10 <- aov(D_Soy[[10]]~D_Soy[[1]], data = D_Soy)
anovasoy11 <- aov(D_Soy[[11]]~D_Soy[[1]], data = D_Soy)
```


After the ANOVAs are done, the normality is tested, using the Shapiro test: 
```{r Shapiro ,message = FALSE, warning = FALSE, results="hide"}
#shapiro tests Bean
shapiro.test(anovabean3$residuals)
shapiro.test(anovabean4$residuals)
shapiro.test(anovabean5$residuals)
shapiro.test(anovabean6$residuals)
shapiro.test(anovabean7$residuals)
shapiro.test(anovabean8$residuals)
shapiro.test(anovabean9$residuals)
shapiro.test(anovabean10$residuals)
shapiro.test(anovabean11$residuals)

#shapiro test Maize
shapiro.test(anovamaize3$residuals)
shapiro.test(anovamaize4$residuals)
shapiro.test(anovamaize5$residuals)
shapiro.test(anovamaize6$residuals)
shapiro.test(anovamaize7$residuals)
shapiro.test(anovamaize8$residuals)
shapiro.test(anovamaize9$residuals)
shapiro.test(anovamaize10$residuals)
shapiro.test(anovamaize11$residuals)

#shapiro test Soy
shapiro.test(anovasoy3$residuals)
shapiro.test(anovasoy4$residuals)
shapiro.test(anovasoy5$residuals)
shapiro.test(anovasoy6$residuals)
shapiro.test(anovasoy7$residuals)
shapiro.test(anovasoy8$residuals)
shapiro.test(anovasoy9$residuals)
shapiro.test(anovasoy10$residuals)
shapiro.test(anovasoy11$residuals)

```


The homoscedaticity is also a requirement in order to approve the results of the ANOVA. It has been tested using the Breusch-Pagan test: 

```{r Homoscedaticity,message = FALSE, warning = FALSE, results="hide"}
#BEAN
bptest(anovabean3)
bptest(anovabean4)
bptest(anovabean5)
bptest(anovabean6)
bptest(anovabean7)
bptest(anovabean8)
bptest(anovabean9)
bptest(anovabean10)
bptest(anovabean11)

#MAIZE
bptest(anovamaize3)
bptest(anovamaize4)
bptest(anovamaize5)
bptest(anovamaize6)
bptest(anovamaize7)
bptest(anovamaize8)
bptest(anovamaize9)
bptest(anovamaize10)
bptest(anovamaize11)

#SOY
bptest(anovasoy3)
bptest(anovasoy4)
bptest(anovasoy5)
bptest(anovasoy6)
bptest(anovasoy7)
bptest(anovasoy8)
bptest(anovasoy9)
bptest(anovasoy10)
bptest(anovasoy11)

```

As a summary, the Table 1 shows the results of ANOVA and the normality and homoscedasticity tests:

```{r ANOVA RESULTS, message = FALSE, warning = FALSE}
anovaresult.crop <- rep(c("Bean", "Maize", "Soybean"), each = 9)

anovaresult.variable <- rep(c(names(D_GH[,3:11])), 3) 

pvalue.bean <-c("0.0124 *", "0.0788", "0.628", "0.203", "0.061", "9.04e-10 ***", "0.623", "0.0245 *", "0.462")
pvalue.maize <- c("9.53e-07 ***", "0.0064 **", "0.0129 *", "0.00552 **", "0.0274 *" , "0.00933 **", "0.000103 ***","0.637", "0.0209 *")
pvalue.soy <- c("0.0311 *", "0.465", "0.216", "0.245", "0.94", "0.347", "0.232", "0.557", "0.7")
pvalue <- c(pvalue.bean, pvalue.maize, pvalue.soy)

normality.result.bean <- c("Yes","Yes","Yes","Yes","No","No","Yes","Yes","Yes")
normality.result.maize <- c("Yes","Yes","Yes","Yes","No","No","No","Yes","Yes")
normality.result.soy <- c("Yes","Yes","Yes","Yes","No","No","No","Yes","Yes")
normality.result <-  c(normality.result.bean, normality.result.maize, normality.result.soy)

homoscedasticity.result.bean <- c("No", "Yes", "Yes", "Yes", "Yes", "Yes", "No", "Yes", "Yes")
homoscedasticity.result.maize <- c( "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes")
homoscedasticity.result.soy <- c( "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes")
homoscedasticity.result <- c(homoscedasticity.result.bean, homoscedasticity.result.maize, homoscedasticity.result.soy)

anova.dataframe <-  data.frame(anovaresult.crop,anovaresult.variable,  pvalue, normality.result, homoscedasticity.result)

anova.dataframe <-  anova.dataframe %>% 
  rename(Crop = anovaresult.crop,
         Variable = anovaresult.variable,
         "ANOVA   *a" = pvalue,
         "Normality   *b" = normality.result,
         "Homoscedasticity  *c"= homoscedasticity.result)

AnovaTable <- kbl(anova.dataframe, align = "c") %>%
  collapse_rows(1, valign = "middle") %>% 
  column_spec(2, color= ifelse(pvalue == "0.0788"| pvalue == "0.628"| pvalue == "0.203"| pvalue == "0.061"| pvalue == "0.623"| pvalue == "0.462"| pvalue =="0.637"| pvalue == "0.465"| pvalue == "0.216"| pvalue == "0.245"| pvalue == "0.94"| pvalue == "0.347"| pvalue == "0.232"| pvalue == "0.557"| pvalue == "0.7", "red", "black")) %>% 
  kable_material(c("striped", "hover")) %>% 
  footnote(general = "Table 1: Results of ANOVA analysis for the different dependent variables in each crop, and the tests for normality and homoscedaticity required. Degrees of freedom = 7. 
           a: ANOVA's P-value. Red color indicates P-values over 0.05, adressing not signifficant data. *: 95% confidance; **: 99%; ***: 99.9%
           b: Normality tested with Shapiro-Wilk test.*
           c: Homocedasticity tested with the Breusch-Pagan test", general_title = "")
AnovaTable
```

### Post hoc analysis

For those variables who do not fulfill the conditions to validate ANOVA, a non-parametrical test needs to be done. In this case we have used the Kruskal-Wallis test from the ```agricolae``` package, which gives directly the different groups. 

```{r Kruskal-Wallis, message = FALSE, warning = FALSE, results="hide"}
#Kruskal-Wallis for Bean 
kruskalbean3 <- kruskal(D_Bean[[3]],D_Bean[[1]], alpha = 0.05)
kruskalbean7 <- kruskal(D_Bean[[7]],D_Bean[[1]], alpha = 0.05)
kruskalbean8 <- kruskal(D_Bean[[8]],D_Bean[[1]], alpha = 0.05)
kruskalbean9 <- kruskal(D_Bean[[9]],D_Bean[[1]], alpha = 0.05)

kruskalbean3
kruskalbean7
kruskalbean8
kruskalbean9

#Kruskal-Wallis for Soy 
kruskalsoy7 <- kruskal(D_Soy[[7]],D_Soy[[1]], alpha = 0.05)
kruskalsoy8 <- kruskal(D_Soy[[8]],D_Soy[[1]], alpha = 0.05)
kruskalsoy9 <- kruskal(D_Soy[[9]],D_Soy[[1]], alpha = 0.05)

kruskalsoy7
kruskalsoy8
kruskalsoy9

#Kruskal-Wallis for Maize
kruskalmaize7 <- kruskal(D_Maize[[7]],D_Maize[[1]], alpha = 0.05)
kruskalmaize8 <- kruskal(D_Maize[[8]],D_Maize[[1]], alpha = 0.05)
kruskalmaize9 <- kruskal(D_Maize[[9]],D_Maize[[1]], alpha = 0.05)

kruskalmaize7
kruskalmaize8
kruskalmaize9


```

The variables who satisfy all the requirements for ANOVA can be tested with Tukey's or Duncan's tests in order to form groups that show the performance of the inoculation experiments in the greenhouse. Once again, Tukey test was carried out, but when  the low sensibility of the results observed (most of the strains were in the same group, without noticing any difference), Duncan's test was proposed as an alternative, providing more diverse grouping. 

```{r Tukey, message = FALSE, warning = FALSE, results="hide"}

Tukey.Bean3=HSD.test(anovabean3,"D_Bean[[1]]", group=TRUE, alpha=0.05)
Tukey.Bean3$groups
Tukey.Bean4=HSD.test(anovabean4,"D_Bean[[1]]", group=TRUE, alpha=0.05)
Tukey.Bean4$groups
Tukey.Bean5=HSD.test(anovabean5,"D_Bean[[1]]", group=TRUE, alpha=0.05)
Tukey.Bean5$groups
Tukey.Bean6=HSD.test(anovabean6,"D_Bean[[1]]", group=TRUE, alpha=0.05)
Tukey.Bean6$groups
Tukey.Bean9=HSD.test(anovabean9,"D_Bean[[1]]", group=TRUE, alpha=0.05)
Tukey.Bean9$groups
Tukey.Bean10=HSD.test(anovabean10,"D_Bean[[1]]", group=TRUE, alpha=0.05)
Tukey.Bean10$groups
Tukey.Bean11=HSD.test(anovabean11,"D_Bean[[1]]", group=TRUE, alpha=0.05)
Tukey.Bean11$groups

Tukey.Soy3=HSD.test(anovasoy3,"D_Soy[[1]]", group=TRUE, alpha=0.05)
Tukey.Soy3$groups
Tukey.Soy4=HSD.test(anovasoy4,"D_Soy[[1]]", group=TRUE, alpha=0.05)
Tukey.Soy4$groups
Tukey.Soy5=HSD.test(anovasoy5,"D_Soy[[1]]", group=TRUE, alpha=0.05)
Tukey.Soy5$groups
Tukey.Soy6=HSD.test(anovasoy6,"D_Soy[[1]]", group=TRUE, alpha=0.05)
Tukey.Soy6$groups
Tukey.Soy10=HSD.test(anovasoy10,"D_Soy[[1]]", group=TRUE, alpha=0.05)
Tukey.Soy10$groups
Tukey.Soy11=HSD.test(anovasoy11,"D_Soy[[1]]", group=TRUE, alpha=0.05)
Tukey.Soy11$groups

Tukey.Maize3=HSD.test(anovamaize3,"D_Maize[[1]]", group=TRUE, alpha=0.05)
Tukey.Maize3$groups
Tukey.Maize4=HSD.test(anovamaize4,"D_Maize[[1]]", group=TRUE, alpha=0.05)
Tukey.Maize4$groups
Tukey.Maize5=HSD.test(anovamaize5,"D_Maize[[1]]", group=TRUE, alpha=0.05)
Tukey.Maize5$groups
Tukey.Maize6=HSD.test(anovamaize6,"D_Maize[[1]]", group=TRUE, alpha=0.05)
Tukey.Maize6$groups
Tukey.Maize10=HSD.test(anovamaize10,"D_Maize[[1]]", group=TRUE, alpha=0.05)
Tukey.Maize10$groups
Tukey.Maize11=HSD.test(anovamaize11,"D_Maize[[1]]", group=TRUE, alpha=0.05)
Tukey.Maize11$groups

```

```{r Duncan, message = FALSE, warning = FALSE, results="hide" }

Duncan.Soy3 <- duncan.test(anovasoy3,"D_Soy[[1]]")
Duncan.Soy3$groups
Duncan.Soy4 <- duncan.test(anovasoy4,"D_Soy[[1]]")
Duncan.Soy4$groups
Duncan.Soy5 <- duncan.test(anovasoy5,"D_Soy[[1]]")
Duncan.Soy5$groups
Duncan.Soy6 <- duncan.test(anovasoy6,"D_Soy[[1]]")
Duncan.Soy6$groups
Duncan.Soy10 <- duncan.test(anovasoy10,"D_Soy[[1]]")
Duncan.Soy10$groups
Duncan.Soy11 <- duncan.test(anovasoy11,"D_Soy[[1]]")
Duncan.Soy11$groups

Duncan.Bean3 <- duncan.test(anovabean3,"D_Bean[[1]]")
Duncan.Bean3$groups
Duncan.Bean4 <- duncan.test(anovabean4,"D_Bean[[1]]")
Duncan.Bean4$groups
Duncan.Bean5 <- duncan.test(anovabean5,"D_Bean[[1]]")
Duncan.Bean5$groups
Duncan.Bean6 <- duncan.test(anovabean6,"D_Bean[[1]]")
Duncan.Bean6$groups
Duncan.Bean9 <- duncan.test(anovabean9,"D_Bean[[1]]")
Duncan.Bean9$groups
Duncan.Bean10 <- duncan.test(anovabean10,"D_Bean[[1]]")
Duncan.Bean10$groups
Duncan.Bean11 <- duncan.test(anovabean11,"D_Bean[[1]]")
Duncan.Bean11$groups

Duncan.Maize3 <- duncan.test(anovamaize3,"D_Maize[[1]]")
Duncan.Maize3$groups
Duncan.Maize4 <- duncan.test(anovamaize4,"D_Maize[[1]]")
Duncan.Maize4$groups
Duncan.Maize5 <- duncan.test(anovamaize5,"D_Maize[[1]]")
Duncan.Maize5$groups
Duncan.Maize6 <- duncan.test(anovamaize6,"D_Maize[[1]]")
Duncan.Maize6$groups
Duncan.Maize10 <- duncan.test(anovamaize10,"D_Maize[[1]]")
Duncan.Maize10$groups
Duncan.Maize11 <- duncan.test(anovamaize11,"D_Maize[[1]]")
Duncan.Maize11$groups
```

## Strain evaluation results

As a summary of the results obtained in this process, tables 2, 3 and 4 display the different variables measured and the most optimal strain according to the most appropriate test. 

### Bean

```{r BEAN STRAINS}
strain.bean <-  c("Control","NA", "NA", "NA", "Control", "LSM_183/LSM_68/LSM_179","LSM_14", "NA",  "NA")
posthoc.bean <- c("Kruskal-Wallis", "Not significant", "Not significant", "Not significant", "Kruskal-Wallis","Kruskal-Wallis","Kruskal-Wallis", "Not significant", "Not significant")
var.name.bean <- c("Plant Height", "Shoot dry mass", "Root dry mass", "Total dry mass", "P soil", "P shoot", "P root", "N shoot", "N root")
bean.name <- c(rep("Bean", 9))
bean.groups <- c("a, ab, abc, abc, abc, bcd, cd, d","a, a, a, a, a, a, a, a", "a, a, a, a, a, a, a, a","a, a, a, a, a, a, a, a","a, ab, ab, b, b, b, b, b", "a, a, a, b, b, b, b, b", "a, ab, ab, ab, ab, ab, ab, b","a, a, a, a, a, a, a, a", "a, a, a, a, a, a, a, a")
data.strains.beans <- data.frame(bean.name, var.name.bean, posthoc.bean,bean.groups, strain.bean)

data.strains.beans <-  data.strains.beans %>% 
  rename("Crop" = bean.name,
         "Variable" = var.name.bean,
         "Post-hoc analysis" = posthoc.bean,
         "Groups"= bean.groups,
         "Optimal strain" = strain.bean)
BeanTable <- kbl(data.strains.beans) %>% 
  kable_styling(bootstrap_options = c("hover"))%>%
  column_spec(1, bold = T) %>%
  column_spec(c(1:4), border_left = FALSE, border_right = FALSE) %>% 
  collapse_rows(columns = 1, valign = "middle") %>% 
  footnote(general = "Table 2: Optimal strains for each variable measured in bean greenhouse experiments adressed by Kruskal-Wallis, or Duncan analysis when significant differences are found. NA: Not applicable", general_title = "")

BeanTable
```

As shown above, no clear results were obtained in the inoculation of bean plants with the different strains. In spite of this, it highlights the results obtained in the case of solubilized P in shoots and roots, where the strains LSM 183, 179 and 68 (shoot) and LSM (14) appear as the optimal choice. 

```{r Bean P shoot}
Bplot_Pshoot <- ggplot(D_Bean, aes(x=`Treatments (strains)`, y=`P Shoot g/kg`, fill=kruskalbean8$groups[`Treatments (strains)`, "groups"])) +
  geom_boxplot()+
  labs(fill = "Strain groups")+
  xlab('Strain') +
  ylab('Mean solubilized P in shoot (g/kg)')+
  labs(title = "[P] in shoot in Bean",
    caption= "Graph 1: Mean solubilized P in bean's shoot (g/kg) in different strains. Groups made by Kruskall-Wallis' test. ")+
  theme(plot.title = element_text(hjust = 0.5),
        plot.caption = element_text(hjust = 0))
Bplot_Pshoot
```

```{r Bean P root}
Bplot_Proot <- ggplot(D_Bean, aes(x=`Treatments (strains)`, y=`P Roots g/kg`, fill=kruskalbean9$groups[`Treatments (strains)`, "groups"])) +
  geom_boxplot()+
  labs(fill = "Strain groups") +
  xlab('Strain') +
  ylab('Mean solubilized P in shoot (g/kg)')+
  labs(title = "[P] in root in Bean",
         caption= "Graph 2: Mean solubilized P in bean's root (g/kg) in different strains. Groups made by Kruskall-Wallis' test. ")+
  theme(plot.title = element_text(hjust = 0.5),
        plot.caption = element_text(hjust = 0))
Bplot_Proot
```

### Maize

```{r MAIZE STRAINS}
strain.maize <-  c("LSM_65","LSM_65","Control","Control/LSM_65", "LSM_24", "LSM_24", "Control/LSM_65/LSM_14/LSM_24/LSM_62", "NA","LSM_65/LSM_24")
posthoc.maize <-  c("Duncan","Duncan","Duncan","Duncan","Kruskal-Wallis","Kruskal-Wallis","Kruskal-Wallis", "Not significant", "Duncan" )
var.name.maize <- c("Plant Height", "Shoot dry mass","Root dry mass", "Total dry mass", "P soil", "P shoot", "P root","N shoot", "N root" )
maize.name <-  c(rep("Maize", 9))
maize.groups <- c("a, ab, bc, bc, cd, cd, de, e","a, ab, ab, ab, abc, bc, bc, c","a, ab, abc, abc, bc, bc, c, c","a, a, ab, ab, abc, bc, bc, c","a, ab, abc, abc, abc, bc, bc, bc, c", "a, ab, ab, bc, bc, c, c, c", "a, a, a, a, a, b, b, b", "a, a, a, a, a, a, a, a", "a,a,ab,ab,ab,ab,bc,c")
data.strains.maize <-  data.frame(maize.name, var.name.maize, posthoc.maize,maize.groups, strain.maize)

data.strains.maize <- data.strains.maize %>% 
  rename("Crop" = maize.name,
          "Variable" = var.name.maize,
          "Post-hoc analysis" = posthoc.maize,
         "Groups"= maize.groups,
          "Optimal strain" = strain.maize)
MaizeTable <- kbl(data.strains.maize) %>% 
  kable_styling(bootstrap_options = c("hover"))%>%
  column_spec(1, bold = T) %>%
  column_spec(c(1:4), border_left = FALSE, border_right = FALSE) %>% 
  collapse_rows(columns = 1:2, valign = "middle") %>% 
  footnote(general = "Table 3: Optimal strains for each variable measured in maize greenhouse experiments adressed by Kruskal-Wallis or Duncan analysis when significant differences are found. NA: Not applicable.", general_title = "")

MaizeTable
```

In this case, it is visible that the parameters are mainly affected by 2 strains. Strain LSM 65 has a positive effect in the growth-related variables, whereas strain LSM 24 is the best performer for the biochemical traits like P solubilization. 

```{r Maize Plant Height}
Mplot_Height <- ggplot(D_Maize, aes(x=`Treatments (strains)`, y=`Plant high (Mean - cm)`, fill=Duncan.Maize3$groups[`Treatments (strains)`, "groups"])) +
  geom_boxplot()+
  labs(fill = "Strain groups") +
  xlab('Strain') +
  ylab('Mean plant height (cm)')+
  labs(title = "Plant height in Maize",
    caption= "Graph 3: Mean plant height (cm) in maize. Groups made by Duncan's test.")+
  theme(plot.title = element_text(hjust = 0.5),
        plot.caption = element_text(hjust = 0))
  
Mplot_Height
```

```{r Maize shoot dry mass}
Mplot_Shootmass <- ggplot(D_Maize, aes(x=`Treatments (strains)`, y= `Shoot dry mass (g)`,fill=Duncan.Maize4$groups[`Treatments (strains)`, "groups"] )) +
  geom_boxplot()+
  labs(fill = "Strain groups") +
  xlab('Strain') +
  ylab('Mean shoot dry mass (g)')+
  labs(title = "Shoot dry mass in Maize",
    caption= "Graph 4: Mean shoot dry mass (g) in maize. Groups made by Duncan's test.")+
  theme(plot.title = element_text(hjust = 0.5),
        plot.caption = element_text(hjust = 0))
Mplot_Shootmass
```

```{r Total dry mass maize}
Mplot_Totalmass <- ggplot(D_Maize, aes(x=`Treatments (strains)`, y=`Total dry mass (g)`,fill=Duncan.Maize6$groups[`Treatments (strains)`, "groups"] )) +
  geom_boxplot()+
  labs(fill = "Strain groups") +
  xlab('Strain') +
  ylab('Mean total dry mass (g)')+
  labs(title = "Total dry mass in Maize",
    caption= "Graph 5: Mean total dry mass (g) in maize. Groups made by Duncan's test.")+
  theme(plot.title = element_text(hjust = 0.5),
        plot.caption = element_text(hjust = 0))
Mplot_Totalmass 
```

```{r P soil Maize}
Mplot_Psoil <- ggplot(D_Maize, aes(x=`Treatments (strains)`, y=`P Soil (mg/dm3)`, fill=kruskalmaize7$groups[`Treatments (strains)`, "groups"])) +
  geom_boxplot()+
  labs(fill = "Strain groups") +
  xlab('Strain') +
  ylab('Mean P solubilized in soil (mg/dm3)')+
  labs(title = "[P] in soil in Maize",
    caption= "Graph 6: Solubilized P in soil in maize (mg/dm3). Groups made by Kruskal-Wallis' test.")+
  theme(plot.title = element_text(hjust = 0.5),
        plot.caption = element_text(hjust = 0))
Mplot_Psoil  
```

```{r P shoot Maize}
Mplot_Pshoot <- ggplot(D_Maize, aes(x=`Treatments (strains)`, y=`P Shoot g/kg`, fill=kruskalmaize8$groups[`Treatments (strains)`, "groups"])) +
  geom_boxplot()+
  labs(fill = "Strain groups") +
  xlab('Strain') +
  ylab('Mean P solubilized in shoot (mg/dm3)')+
  labs(title = "[P] in shoot in Maize",
    caption= "Graph 7: Solubilized P in shoot in maize (mg/dm3). Groups made by Kruskal-Wallis' test.")+
  theme(plot.title = element_text(hjust = 0.5),
        plot.caption = element_text(hjust = 0))
Mplot_Pshoot
```

```{r N root maize}
Mplot_Nroot <- ggplot(D_Maize, aes(x=`Treatments (strains)`, y= `N Roots g/kg`, fill=Duncan.Maize11$groups[`Treatments (strains)`, "groups"] )) +
  geom_boxplot()+
  labs(fill = "Strain groups") +
  xlab('Strain') +
  ylab('Mean N in roots (g/kg)')+
  labs(title = "N in root in Maize",
    caption= "Graph 8: N concentration in root in maize (mg/dm3). Groups made by Duncan's test.")+
  theme(plot.title = element_text(hjust = 0.5),
        plot.caption = element_text(hjust = 0))
Mplot_Nroot
```

### Soybean

```{r SOYBEAN STRAINS}
strain.soy <- c("LSM_179", "NA", "NA",  "NA", "All", "LSM_14/LSM_24/LSM_62", "LSM_183/LSM_179", "NA","NA")
posthoc.soy <- c("Duncan", "Duncan", "Duncan", "Duncan","Kruskal-Wallis","Kruskal-Wallis","Kruskal-Wallis", "Duncan", "Duncan" )
var.name.soy <- c("Plant Height",  "Shoot dry mass","Root dry mass",  "Total dry mass",  "P soil", "P shoot", "P root","N shoot",  "N root" )
soy.name <-  c(rep("Soybean", 9))
soy.groups <- c("a, ab, ab, abc, abc, bc, bc, c", "a, a, a, a, a, a, a, a", "a, a, a, a, a, a, a, a", "a, a, a, a, a, a, a, a", "a, a, a, a, a, a, a, a", "a, a, a, ab, ab, ab, ab, b", "a, a, ab, ab, ab, ab, ab, b", "a, a, a, a, a, a, a, a", "a, a, a, a, a, a, a, a")
data.strains.soy <-  data.frame(soy.name, var.name.soy, posthoc.soy, soy.groups, strain.soy)

data.strains.soy <- data.strains.soy %>% 
  rename("Crop" = soy.name,
         "Variable" = var.name.soy,
         "Post-hoc analysis" = posthoc.soy,
         "Optimal strain" = strain.soy)
SoybeanTable <- kbl(data.strains.soy) %>% 
  kable_styling(bootstrap_options = c("hover"))%>%
  column_spec(1, bold = T) %>%
  column_spec(c(1:4), border_left = FALSE, border_right = FALSE) %>% 
  collapse_rows(columns = 1:2, valign = "middle") %>% 
  footnote(general = "Table 4: Optimal strains for each variable measured in soybean greenhouse experiments adressed by Kruskal-Wallis, or Duncan analysis when significant differences are found. NA: Not applicable.", general_title = "")

SoybeanTable
```

Last, the experiments in soybean show how this plant is affected by LSM 179, 183, 14, 24 and 62, but only in 3 parameters. In the rest of them, no significant difference has been found. 

```{r Plant Height Soy}
Splot_Height <- ggplot(D_Soy, aes(x=`Treatments (strains)`, y=`Plant high (Mean - cm)`, fill=Duncan.Soy3$groups[`Treatments (strains)`, "groups"])) +
  geom_boxplot()+
  labs(fill = "Strain groups") +
  xlab('Strain') +
  ylab('Mean plant height (cm)')+
  labs(title = "Plant height in Soybean",
    caption= "Graph 9: Mean plant height (cm) in soybean. Groups made by Duncan's test.")+
  theme(plot.title = element_text(hjust = 0.5),
        plot.caption = element_text(hjust = 0))
Splot_Height
```

```{r P shoot Soy}
Splot_Pshoot <- ggplot(D_Soy, aes(x=`Treatments (strains)`, y=`P Shoot g/kg`, fill=kruskalsoy8$groups[`Treatments (strains)`, "groups"])) +
  geom_boxplot()+
  labs(fill = "Strain groups") +
  xlab('Strain') +
  ylab('Mean P solubilized in shoot (g/kg)')+
  labs(title = "[P] in shoot in Maize",
    caption= "Graph 10: Mean P solubilized in soybean's shoot. Groups made by Kruskal-Wallis' test.")+
  theme(plot.title = element_text(hjust = 0.5),
        plot.caption = element_text(hjust = 0))
Splot_Pshoot 
```


```{r P root Soy}
Splot_Proot <- ggplot(D_Soy, aes(x=`Treatments (strains)`, y=`P Roots g/kg`, fill=kruskalsoy9$groups[`Treatments (strains)`, "groups"])) +
  geom_boxplot()+
  labs(fill = "Strain groups") +
  xlab('Strain') +
  ylab('Mean P solubilized in shoot (g/kg)')+
  labs(title = "[P] in root in Soybean",
    caption= "Graph 11: Mean solubilized P in soybean's roots. Groups made by Kruskal-Wallis' test.")+
  theme(plot.title = element_text(hjust = 0.5),
        plot.caption = element_text(hjust = 0))
Splot_Proot  
```


##PCA
```{r}
#Adding column for individual identification of points based on the treatment
D_GH$Name <- paste(D_GH$`Treatments (strains)`,"_",D_GH$`Repetition (pots)`)
      #eliminate this name column

#Data for PCA 
#D_PCA <- D_GH [-2]
#D_PCA <- D_GH [3:11]
#data (D_GH)

#General PCA
C_pca <- prcomp(D_GH [3:11], scale = TRUE)
factoextra::fviz_eig(C_pca)
factoextra::fviz_pca_ind(C_pca,
             col.ind = "cos2", # Color by the quality of representation
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07", "#FF0066"),
             repel = TRUE     # Avoid text overlapping
)
```

PCA with colored crops
```{r}
#PCA with colored crops
groups_c <- as.factor(D_GH$Cropname)
factoextra::fviz_pca_ind(C_pca,
             col.ind = groups_c, # color by groups
             palette = c("#00AFBB", "#E7B800", "#FC4E07", "#FF0066"),
             addEllipses = TRUE, # Concentration ellipses
             ellipse.type = "confidence",
             legend.title = "Crops",
             repel = TRUE
)
```
The x axis separes very nicely the crops from each other


Biplot about crops
```{r}
factoextra::fviz_pca_biplot(C_pca,
                           col.ind = groups_c,#color by groups
                           palette = c("#00AFBB", "#E7B800", "#FC4E07", "#FF0066"),
                           addEllipses = TRUE, # Concentration ellipses
                           ellipse.type = "confidence",
                           legend.title = "Crops",
                           repel = TRUE
)
#Opposite direction arrows indicate negative correlations between the variables
```
PCA for each crop (dif colors), discriminating treatments with names
```{r}
D1 <- D_GH [, 3:11]

rownames(D1) <- paste0(D_GH$Cropname, D_GH$Name)
T_pca <- prcomp(D1, scale = TRUE)
factoextra::fviz_pca_ind(T_pca,
                         col.ind = groups_c,
                         palette = c("#00AFBB", "#E7B800", "#FC4E07", "#FF0066"),
                         addEllipses = TRUE, # Concentration ellipses
                         ellipse.type = "confidence",
                         legend.title = "Treatments",
                         repel = TRUE
)

#PCA1 written formula
T_pca$rotation
formula1 <- "PC1 = "
a <-  as.data.frame(T_pca$rotation)
for (i in 1:length(a$PC1)) {
  if (a$PC1[i] >= 0) formula1 <- paste(formula1, "+") 
  formula1 <- paste(formula1, a$PC1[i], rownames(a)[i])
}
  
```

PCA with different colored treatments (shows that we need to subset each crop)
```{r}
groups_t <- as.factor(D_GH$`Treatments (strains)`)
factoextra::fviz_pca_ind(C_pca,geom ="point",
                         col.ind = groups_t, # color by groups
                         #palette = c("#00AFBB", "#E7B800", "#FC4E07", "#FF0066"),
                         #addEllipses = TRUE, # Concentration ellipses
                         #ellipse.type = "confidence",
                         legend.title = "Strains",
                         repel = FALSE
)
```
The PCA doesn't divide the points by strains

Subset each species with each name
Bean
```{r}
D_GHb<- D_GH[,c(3:13)]
D_GHb <- D_GHb[D_GHb$Cropname == "Bean",]
Name <- D_GHb$Name
D_GHb <- D_GHb [1:9]
rownames(D_GHb)<-Name
B_pca <- prcomp(D_GHb, scale = TRUE)
factoextra::fviz_pca_ind(B_pca,
                         geom = c("point", "text"),
                         #col.ind = groups_t,
                         #palette = c("#00AFBB", "#E7B800", "#FC4E07", "#FF0066"),
                         addEllipses = TRUE, # Concentration ellipses
                         ellipse.type = "confidence",
                         #legend.title = "Treatments",
                         repel = FALSE
)

factoextra::fviz_pca_var(B_pca,
                         col.var = "contrib", # Color by contributions to the PC
                         gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
                         repel = TRUE
)
```

Soybean
```{r}
D_GHs<- D_GH[,c(3:13)]
D_GHs<- D_GHs[D_GHs$Cropname == "Soybean",]
Name <- D_GHs$Name
D_GHs <- D_GHs [1:9]
rownames(D_GHs)<-Name
S_pca <- prcomp(D_GHs, scale = TRUE)
factoextra::fviz_pca_ind(S_pca,
                         geom = c("point", "text"),
                         #col.ind = groups_t,
                         #palette = c("#00AFBB", "#E7B800", "#FC4E07", "#FF0066"),
                         #addEllipses = TRUE, # Concentration ellipses
                         #ellipse.type = "confidence",
                         #legend.title = "Treatments",
                         repel = FALSE
)

factoextra::fviz_pca_var(S_pca,
                         col.var = "contrib", # Color by contributions to the PC
                         gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
                         repel = TRUE
)

```

Maize
```{r}
D_GHm<- D_GH[,c(3:13)]
D_GHm <- D_GHm[D_GHm$Cropname == "Maize",]
Name <- D_GHm$Name
D_GHm <- D_GHm [1:9]
rownames(D_GHm)<-Name
M_pca <- prcomp(D_GHm, scale = TRUE)
factoextra::fviz_pca_ind(M_pca,
                         geom = c("point", "text"),
                         #col.ind = groups_t,
                         #palette = c("#00AFBB", "#E7B800", "#FC4E07", "#FF0066"),
                         #addEllipses = TRUE, # Concentration ellipses
                         #ellipse.type = "confidence",
                         #legend.title = "Treatments",
                         repel = FALSE
)

factoextra::fviz_pca_var(M_pca,
                         col.var = "contrib", # Color by contributions to the PC
                         gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
                         repel = TRUE
)
```
Strains are not separated even if do a PCA for each crop.

Height and dry mass seem to be the parameters that separate the strains the most in all crops

##Moderator analysis

##Discriminant analysis
=======
**Maize** is more affected by strains LSM 65 in the Plant Height and Shoot dry mas, LSM 24 in the P soil and P shoot, and both of them , LSM 65 and 24, have similar effects in the N root
>>>>>>> 91c55e4d66c4c5923c372adb8ea37a7d2db4af95
